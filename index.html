<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kimotor | Conversión Profesional a Gas en España</title>
    <meta name="keywords" content="GLP, conversión gas, ahorro combustible, taller homologado España, instalación GLP">

    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="./styles/glp.css">

    <style>
        /* Estilos para el chatbot (se añadirán dinámicamente) */
        .chatbot-styles {
            display: none;
        }

        /* Estilos para la burbuja de chat (añadidos directamente) */
        .chat-bubble {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            transition: transform 0.3s ease;
        }

        .chat-bubble:hover {
            transform: scale(1.1);
        }

        .chat-bubble svg {
            width: 30px;
            height: 30px;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            font-weight: bold;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

   <div id="kimotor-navbar-container">
        <!-- Barra superior - Aumentada de tamaño -->
        <div class="kimotor-top-bar" id="topBar">
            <div class="kimotor-container">
                <div class="top-bar-left">
                    <div class="contact-info">
                        <span><i class="fas fa-phone-alt"></i> 914 903 762</span>
                        <span><i class="far fa-clock"></i> L-V 7:00 - 17:00</span>
                        <span><i class="fas fa-map-marker-alt"></i> Calle Granja, 17 Alcobendas</span>
                    </div>
                </div>
                <div class="top-bar-right">
                    <a href="https://www.cloudactivereception.com/appointment/kimotor" class="appointment-btn">
                        <i class="far fa-calendar-alt"></i> CITA PREVIA
                    </a>
                    <a target="_blank"  href="https://wa.me/+34607574912" class="whatsapp-btn">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </a>
                    <div class="social-icons">
                        <a href="https://www.facebook.com/KIMOTOR2005" target="_blank"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://twitter.com/home/?status=https://www.kimotor2005.es/" target="_blank"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.youtube.com/channel/UCLZ7OAL-d4AeHC01ivRJ-xQ" target="_blank"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Barra principal con superposición -->
        <div class="kimotor-main-nav" id="mainNav">
    <div class="kimotor-container">
        <a href="https://kimotor2005.es/" class="logo">
            <img src="https://kimotor2005.es/wp-content/uploads/2018/10/kimotor2005.png" alt="Ki Motor" width="190">
        </a>

        <div class="nav-menu-container">
            <ul class="main-menu">
                <li><a href="/home">Home</a></li>
                <li class="has-submenu">
                    <a href="#">Empresa</a>
                    <ul class="submenu">
                        <li><a href="https://kimotor2005.es/quienes-somos/">Quiénes somos</a></li>
                        <li><a href="https://kimotor2005.es/equipo/">Equipo</a></li>
                        <li><a href="https://kimotor2005.es/donde-estamos/">Dónde estamos</a></li>
                        <li><a href="https://kimotor2005.es/resultados-encuesta-satisfaccion/">Resultados Encuesta de Satisfacción</a></li>
                    </ul>
                </li>
                <li><a href="https://kimotor2005.es/instalaciones/">Instalaciones</a></li>
                <!-- li class="has-submenu">
                    <a href="#">Servicios</a>
                    <ul class="submenu">
                        <li><a href="/glp">TRANSFORMACIONES GLP</a></li>
                        <li><a href="/kivi">TRANSFORMACIONES KIVI</a></li>
                        <li><a href="https://kimotor2005.es/taller-de-mecanica-y-electricidad/">MECÁNICA Y ELECTRICIDAD</a></li>
                        <li><a href="https://kimotor2005.es/chapa-y-pintura-alcobendas/">TALLER DE CHAPA Y PINTURA</a></li>
                        <li><a href="https://kimotor2005.es/neumaticos/">NEUMÁTICOS</a></li>
                        <li><a href="https://kimotor2005.es/servicio-rapido/">SERVICIO RÁPIDO</a></li>
                        <li><a href="https://kimotor2005.es/mantenimiento-y-reparacion/">MANTENIMIENTO Y REPARACIÓN</a></li>
                        <li><a href="https://kimotor2005.es/plan-amigos/">PLAN AMIGOS</a></li>
                    </ul>
                </li>
                <li><a href="https://kimotor2005.es/ofertas/">Ofertas</a></li-->
                
                <li><a href="https://kimotor2005.es/noticias/">Noticias</a></li>
                <li><a href="https://kimotor2005.es/contacto/">Contacto</a></li>
            </ul>

            <div class="search-icon">
                <i class="fas fa-search"></i>
            </div>

            <!-- Botón móvil -->
            <div class="mobile-menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </div>
</div>
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-overlay"></div>
        <div class="container">
            <div class="hero-content animate-fadeInUp">
                <h1 class="hero-title">
                    Conduce hacia un futuro
                    <span class="hero-gradient-text">más verde y económico</span>
                </h1>
                <p class="hero-subtitle">
                    Convierte cualquier vehículo con tecnología híbrida certificada y reduce tus emisiones CO₂ en un 60%
                </p>
                <a class="hero-button animate-scaleIn"  href="#presupuesto" >
                   ¡Quiero ahorrar!
                </a>
            </div>
        </div>
        <div class="certifications">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3e/T%C3%9CV_S%C3%9D_Logo.svg/2560px-T%C3%9CV_S%C3%9D_Logo.svg.png" alt="Certificación TÜV">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/ISO_7010_W001_evacuation_route_left_arrow.svg/1200px-ISO_7010_W001_evacuation_route_left_arrow.svg.png" alt="Certificación ISO">
        </div>
    </section>

    <!-- Benefits Section -->
    <section class="benefits-section">
        <div class="container">
            <div class="benefits-intro">
                El Gas Licuado de Petróleo es una alternativa inteligente que combina
                <strong>ahorro económico</strong> con
                <strong class="text-green-900">responsabilidad ambiental</strong>.
                Mantiene el rendimiento de tu vehículo mientras reduces tu gasto en combustible.
            </div>

            <div class="benefits-grid">
                <!-- Benefit 1 -->
                <div class="flip-card animate-fadeInUp">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <div class="card-icon bg-blue-100 border border-blue-200">
                                <i class="fas fa-gas-pump text-blue-600 opacity-80"></i>
                            </div>
                            <h3 class="card-title">Ahorra desde el primer dia!</h3>
                            <p class="card-description">Reducción inmediata en gastos de combustible</p>
                        </div>
                        <div class="flip-card-back">
                            <ul class="card-details">
                                <li><span class="text-blue-600 opacity-80">✓</span> Precio 50% menor que gasolina</li>
                                <li><span class="text-blue-600 opacity-80">✓</span> Mantenimiento más económico</li>
                                <li><span class="text-blue-600 opacity-80">✓</span> Mayor duración del motor</li>
                                <li><span class="text-blue-600 opacity-80">✓</span> Amortización en menos de 1 año</li>
                                <li><span class="text-blue-600 opacity-80">✓</span> Costo por km reducido en un 45%</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Benefit 2 -->
                <div class="flip-card animate-fadeInUp" style="animation-delay: 0.2s">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <div class="card-icon bg-green-100 border border-green-200">
                                <i class="fas fa-leaf text-green-600 opacity-80"></i>
                            </div>
                            <h3 class="card-title">Ecológico</h3>
                            <p class="card-description">Tecnología amigable con el medio ambiente</p>
                        </div>
                        <div class="flip-card-back">
                            <ul class="card-details">
                                <li><span class="text-green-600 opacity-80">✓</span> 90% menos emisiones NOx</li>
                                <li><span class="text-green-600 opacity-80">✓</span> 50% reducción de CO2</li>
                                <li><span class="text-green-600 opacity-80">✓</span> Certificación Euro 6</li>
                                <li><span class="text-green-600 opacity-80">✓</span> Sin partículas sólidas</li>
                                <li><span class="text-green-600 opacity-80">✓</span> Huella de carbono reducida</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Benefit 3 -->
                <div class="flip-card animate-fadeInUp" style="animation-delay: 0.4s">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <div class="card-icon bg-purple-100 border border-purple-200">
                                <i class="fas fa-road text-purple-600 opacity-80"></i>
                            </div>
                            <h3 class="card-title">Rendimiento</h3>
                            <p class="card-description">Instalación profesional garantizada</p>
                        </div>
                        <div class="flip-card-back">
                            <ul class="card-details">
                                <li><span class="text-purple-600 opacity-80">✓</span> Mayor vida util del motor</li>
                                <li><span class="text-purple-600 opacity-80">✓</span> Misma potencia</li>
                                <li><span class="text-purple-600 opacity-80">✓</span> Mas de mil estaciones de repostaje</li>
                                <li><span class="text-purple-600 opacity-80">✓</span> Autonomía combinada de 1000+ km</li>
                                <li><span class="text-purple-600 opacity-80">✓</span> Cambio automático entre combustibles</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Video Section -->
    <section class="video-section">
        <div class="wave-top">
            <svg viewBox="0 0 1440 320" preserveAspectRatio="none">
                <path fill="#ffffff" d="M0,160L80,170.7C160,181,320,203,480,197.3C640,192,800,160,960,138.7C1120,117,1280,107,1360,101.3L1440,96L1440,320L1360,320C1280,320,1120,320,960,320C800,320,640,320,480,320C320,320,160,320,80,320L0,320Z"></path>
            </svg>
        </div>

        <div class="container">
            <div class="video-content">
                <div class="video-wrapper">
                    <iframe width="100%" height="100%" src="https://www.youtube.com/embed/-GDZ2Tmpk7A" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>

                <div class="video-text animate-fadeIn">
                    <h2>Conduce limpio,<br><span>conduce GLP</span></h2>
                    <p>Menos emisiones, misma potencia<br>y autonomía</p>
                    <div class="feature">
                        <div class="icon"><i class="fas fa-bolt"></i></div>
                        <span>Un suspiro para el aire y el bolsillo</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="wave-bottom">
            <svg viewBox="0 0 1440 320" preserveAspectRatio="none">
                <path fill="#ffffff" d="M0,160L80,170.7C160,181,320,203,480,197.3C640,192,800,160,960,138.7C1120,117,1280,107,1360,101.3L1440,96L1440,320L1360,320C1280,320,1120,320,960,320C800,320,640,320,480,320C320,320,160,320,80,320L0,320Z"></path>
            </svg>
        </div>
    </section>

    <!-- Services Section -->
    <section class="services-section">
        <div class="container">
            <div class="services-heading animate-fadeInDown">
                <h2>Tecnología y Experiencia Combinadas</h2>
                <p>Más de 15 años liderando conversiones en la península</p>
            </div>

            <div class="services-grid">
                <!-- Service 1 -->
                <div class="flip-card animate-fadeInUp">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <div class="card-icon bg-blue-100 border border-blue-200">
                                <i class="fas fa-wrench text-blue-600 opacity-80"></i>
                            </div>
                            <h3 class="card-title">Instalación Profesional</h3>
                            <p class="card-description">Técnicos certificados por la UE</p>
                        </div>
                        <div class="flip-card-back">
                            <ul class="card-details">
                                <li><span class="text-blue-600 opacity-80">•</span> Certificación ISO 9001</li>
                                <li><span class="text-blue-600 opacity-80">•</span> Equipos de última generación</li>
                                <li><span class="text-blue-600 opacity-80">•</span> Pruebas de seguridad exhaustivas</li>
                                <li><span class="text-blue-600 opacity-80">•</span> Instalación en 48 horas</li>
                                <li><span class="text-blue-600 opacity-80">•</span> Sistemas de última generación</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Service 2 -->
                <div class="flip-card animate-fadeInUp" style="animation-delay: 0.2s">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <div class="card-icon bg-green-100 border border-green-200">
                                <i class="fas fa-shield-alt text-green-600 opacity-80"></i>
                            </div>
                            <h3 class="card-title">Garantía Integral</h3>
                            <p class="card-description">3 años de cobertura total</p>
                        </div>
                        <div class="flip-card-back">
                            <ul class="card-details">
                                <li><span class="text-green-600 opacity-80">•</span> Cobertura de componentes</li>
                                <li><span class="text-green-600 opacity-80">•</span> Soporte técnico 24/7</li>
                                <li><span class="text-green-600 opacity-80">•</span> Revisión y garantía total por 3 meses</li>
                                <li><span class="text-green-600 opacity-80">•</span> Respuesta inmediata</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Service 3 -->
                <div class="flip-card animate-fadeInUp" style="animation-delay: 0.4s">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <div class="card-icon bg-purple-100 border border-purple-200">
                                <i class="fas fa-file-contract text-purple-600 opacity-80"></i>
                            </div>
                            <h3 class="card-title">Homologación</h3>
                            <p class="card-description">Documentación legal incluida</p>
                        </div>
                        <div class="flip-card-back">
                            <ul class="card-details">
                                <li><span class="text-purple-600 opacity-80">•</span> Certificado oficial ITV</li>
                                <li><span class="text-purple-600 opacity-80">•</span> Asesoramiento legal</li>
                                <li><span class="text-purple-600 opacity-80">•</span> Asistencia en trámites</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Form Section -->
    <section class="form-section">
        <div class="container">
            <h2 class="text-center">¿Listo para empezar a ahorrar?</h2>
            <p id="presupuesto" class="text-center">Nuestro equipo en Madrid te asesorará sin compromiso</p>

            <form class="contact-form animate-scaleIn">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="nombre">Nombre*</label>
                        <input type="text" id="nombre" placeholder="Ej: Ana García" required>
                    </div>
                    <div class="form-group">
                        <label for="apellidos">Apellidos*</label>
                        <input type="text" id="apellidos" placeholder="Ej: Pérez López" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="telefono">Teléfono*</label>
                    <input type="tel" id="telefono" placeholder="+34 600 112 233" required>
                </div>

                <div class="form-group">
                    <label for="email">Email*</label>
                    <input type="email" id="email" placeholder="usuario@dominio.com" required>
                </div>

                <div class="form-group">
                    <label>Vehículo*</label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input id="marca" type="text" placeholder="Marca (Ej: Seat)" required>
                        <input id="modelo" type="text" placeholder="Modelo (Ej: León)" required>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="anio">Año*</label>
                        <input type="number" id="anio" min="2000" max="2024" placeholder="Ej: 2018" required>
                    </div>
                    <div class="form-group">
                        <label for="combustible">Combustible*</label>
                        <select id="combustible" required>
                            <option value="">Seleccionar</option>
                            <option>Gasolina</option>
                            <option>Diésel</option>
                            <option>Híbrido</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="provincia">Provincia*</label>
                    <select id="provincia" required>
                        <option value="">Selecciona tu provincia</option>
                        <option>Madrid</option>
                        <option>Barcelona</option>
                        <option>Valencia</option>
                        <option>Sevilla</option>
                        <option>Zaragoza</option>
                        <option>Málaga</option>
                    </select>
                </div>

                <div class="flex items-start mb-4">
                    <div class="flex items-center h-5">
                        <input
                            id="privacy-policy"
                            name="privacy-policy"
                            type="checkbox"
                            class="w-4 h-4 text-indigo-600 bg-gray-100 border-gray-300 rounded focus:ring-indigo-500 dark:focus:ring-indigo-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600 cursor-pointer transition duration-150 ease-in-out hover:scale-105 hover:border-indigo-500"
                            required
                        >
                    </div>
                    <div class="ms-2 text-sm">
                        <label for="privacy-policy" class="font-medium text-gray-900 dark:text-gray-300 cursor-pointer">
                            Acepto que, Conforme al
                            <a href="https://eur-lex.europa.eu/eli/reg/2016/679/oj/eng" class="text-indigo-600 hover:underline dark:text-indigo-500 font-semibold" target="_blank">
                                RGPD (Reglamento UE 2016/679)
                            </a>
                            y la
                            <a href="https://www.aepd.es/es" class="text-indigo-600 hover:underline dark:text-indigo-500 font-semibold" target="_blank">
                                LOPD-GDD (Ley Orgánica 3/2018)
                            </a>.
                            Tus datos se utilizarán exclusivamente para gestionar tu solicitud y no se compartirán con terceros sin tu consentimiento expreso. Tienes derecho a acceder, rectificar y suprimir tus datos, así como otros derechos como se explica en nuestra política de privacidad.
                        </label>
                    </div>
                </div>

                <button type="submit" class="form-button">
                    ¡Quiero mi presupuesto sin compromiso!
                </button>
                <div id="notification" class="notification hidden"></div>
            </form>

            <div class="contact-info-section">
                <div class="container">
                    <p>
                        <span class="block font-medium">¿Necesitas ayuda?</span>
                        <span class="block mb-2">Escríbenos por WhatsApp o llámanos:</span>

                        <a target="_blank" href="https://wa.me/+34607574912" class="block mb-2">
                            <span class="phone">
                                <i class="fab fa-whatsapp text-blue-700"></i>
                                +34 607 574 912 
                            </span>
                        </a>

                        <div class="mb-2">
                            <span class="phone">
                                <i class="fas fa-phone text-green-700"></i>
                                +34 914 903 762
                                <span class="text-xs text-gray-600 ml-1">(Lunes-Viernes 7:00-17:00)</span>
                            </span>
                        </div>

                        <span class="hours text-sm text-gray-600">
                            <i class="fas fa-info-circle text-blue-400 mr-1"></i>
                            Puedes escribirnos en cualquier momento por WhatsApp
                        </span>
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Google_%22G%22_Logo.svg/2008px-Google_%22G%22_Logo.svg.png" alt="AutoGLP">
                </div>
                <p class="footer-text">Taller autorizado para conversión de vehículos a GLP en España</p>
                <div class="footer-links">
                    <a href="#">Aviso Legal</a>
                    <a href="#">Talleres</a>
                    <a href="#">Preguntas Frecuentes</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Template para el chatbot (oculto inicialmente) -->
    <template id="chatbot-template">
        <div class="fixed-chatbot-container">
            <div class="fixed-chatbot">
                <div class="fixed-chatbot-header">
                    <h3>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                        </svg>
                        Asistente de Ventas KIVI
                    </h3>
                    <div class="fixed-chatbot-actions">
                        <button class="fixed-chatbot-minimize" title="Minimizar">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
                                <path d="M19 13H5v-2h14v2z"/>
                            </svg>
                        </button>
                        <button class="fixed-chatbot-clear" title="Limpiar historial">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="fixed-chatbot-messages">
                    <div class="fixed-message bot">
                        ¡Hola! Soy tu asistente especializado en conversiones GLP y transformaciones KIVI. ¿En qué puedo ayudarte hoy?
                    </div>
                </div>

                <div class="fixed-chatbot-input">
                    <input type="text" placeholder="Escribe tu mensaje..." class="fixed-chatbot-input-field">
                    <button class="fixed-chatbot-send">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </template>

    <!-- Burbuja de chat (siempre visible) -->
    <div class="chat-bubble">
        <svg viewBox="0 0 24 24" fill="white">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
        </svg>
        <div class="notification-badge hidden">1</div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // Detalles del proyecto Supabase
        const SUPABASE_URL = 'https://tubddowbahgxmdwhvgvn.supabase.co';
        const PUBLISHABLE_KEY = 'sb_publishable_QBELiN_jeSsquh_oRpWTDg_cZfAPiju';
        const CHAT_FUNCTION = '/functions/v1/chat-assistant';

        // Estado del chatbot
        let chatHistory = [];
        let unreadMessages = 0;
        let chatbotContainer = null;

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            initChatbot();
        });

        function initChatbot() {
            const chatBubble = document.querySelector('.chat-bubble');

            // Evento para mostrar el chatbot al hacer clic en la burbuja
            chatBubble.addEventListener('click', function() {
                createChatbot();

                // Ocultar la burbuja
                chatBubble.style.display = 'none';

                // Reiniciar contador de mensajes no leídos
                unreadMessages = 0;
                updateNotificationBadge();
            });
        }

        function createChatbot() {
            // Obtener el template
            const template = document.getElementById('chatbot-template');
            const chatbotHTML = template.content.cloneNode(true);

            // Insertar el chatbot en el body
            document.body.appendChild(chatbotHTML);

            // Obtener referencia al contenedor
            chatbotContainer = document.querySelector('.fixed-chatbot-container');

            // Aplicar estilos
            applyChatbotStyles();

            // Inicializar eventos del chatbot
            initChatbotEvents();

            // Reconstruir historial si existe
            if (chatHistory.length > 0) {
                const messagesContainer = document.querySelector('.fixed-chatbot-messages');
                messagesContainer.innerHTML = '';

                chatHistory.forEach(message => {
                    const messageElement = document.createElement('div');
                    messageElement.classList.add('fixed-message', message.sender);
                    messageElement.textContent = message.text;
                    messagesContainer.appendChild(messageElement);
                });

                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }

        function initChatbotEvents() {
            const userInput = document.querySelector('.fixed-chatbot-input-field');
            const sendButton = document.querySelector('.fixed-chatbot-send');
            const clearButton = document.querySelector('.fixed-chatbot-clear');
            const minimizeButton = document.querySelector('.fixed-chatbot-minimize');
            const messagesContainer = document.querySelector('.fixed-chatbot-messages');

            // Enviar mensaje al hacer clic en el botón
            sendButton.addEventListener('click', sendMessage);

            // Enviar mensaje al presionar Enter
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Limpiar historial de chat
            clearButton.addEventListener('click', function() {
                // Mantener solo el primer mensaje del bot
                while (messagesContainer.children.length > 1) {
                    messagesContainer.removeChild(messagesContainer.lastChild);
                }

                // Limpiar historial (excepto el primer mensaje)
                if (chatHistory.length > 0) {
                    const firstMessage = chatHistory[0];
                    chatHistory = [firstMessage];
                }

                // Añadir mensaje de confirmación
                addMessage('Historial limpiado. ¿En qué más puedo ayudarte?', 'bot');
            });

            // Minimizar el chatbot
            minimizeButton.addEventListener('click', function() {
                destroyChatbot();
            });
        }

        function destroyChatbot() {
            if (chatbotContainer) {
                // Guardar el historial antes de destruir
                const messages = document.querySelectorAll('.fixed-chatbot-messages .fixed-message');
                chatHistory = [];

                messages.forEach(message => {
                    chatHistory.push({
                        text: message.textContent,
                        sender: message.classList.contains('user') ? 'user' : 'bot'
                    });
                });

                // Eliminar el chatbot del DOM
                chatbotContainer.remove();
                chatbotContainer = null;

                // Mostrar la burbuja de nuevo
                document.querySelector('.chat-bubble').style.display = 'flex';
            }
        }

        async function sendMessage() {
            const userInput = document.querySelector('.fixed-chatbot-input-field');
            const messagesContainer = document.querySelector('.fixed-chatbot-messages');

            const message = userInput.value.trim();
            if (message === '') return;

            // Añadir mensaje del usuario
            addMessage(message, 'user');
            userInput.value = '';

            // Mostrar indicador de typing
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'fixed-typing-indicator';
            typingIndicator.innerHTML = `
                <span>Asistente está escribiendo</span>
                <div class="fixed-typing-dot"></div>
                <div class="fixed-typing-dot"></div>
                <div class="fixed-typing-dot"></div>
            `;
            messagesContainer.appendChild(typingIndicator);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            try {
                const response = await axios.post(
                    `${SUPABASE_URL}${CHAT_FUNCTION}`,
                    { mensaje: message },
                    {
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${PUBLISHABLE_KEY}`,
                            'apikey': PUBLISHABLE_KEY
                        }
                    }
                );

                // Eliminar indicador de typing
                messagesContainer.removeChild(typingIndicator);

                if (response.data && response.data.respuesta) {
                    addMessage(response.data.respuesta, 'bot');
                } else {
                    addMessage('No recibí una respuesta válida del servidor.', 'bot');
                }
            } catch (error) {
                // Eliminar indicador de typing
                messagesContainer.removeChild(typingIndicator);

                console.error('Error en la solicitud:', error);
                addMessage('Lo siento, ha ocurrido un error al procesar tu mensaje. Por favor, intenta nuevamente.', 'bot');
            }
        }

        function addMessage(text, sender) {
            const messagesContainer = document.querySelector('.fixed-chatbot-messages');

            const messageElement = document.createElement('div');
            messageElement.classList.add('fixed-message', sender);
            messageElement.textContent = text;

            messagesContainer.appendChild(messageElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function updateNotificationBadge() {
            const notificationBadge = document.querySelector('.notification-badge');

            if (unreadMessages > 0) {
                notificationBadge.textContent = unreadMessages;
                notificationBadge.classList.remove('hidden');
            } else {
                notificationBadge.classList.add('hidden');
            }
        }

        function applyChatbotStyles() {
            // Solo aplicar estilos si no se han aplicado antes
            if (!document.getElementById('chatbot-styles')) {
                const styleElement = document.createElement('style');
                styleElement.id = 'chatbot-styles';

                styleElement.textContent = `
                    .fixed-chatbot-container {
                        position: fixed;
                        bottom: 20px;
                        right: 20px;
                        width: 350px;
                        height: 450px;
                        z-index: 10000;
                        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    }

                    .fixed-chatbot {
                        width: 100%;
                        height: 100%;
                        background-color: white;
                        border-radius: 15px;
                        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
                        display: flex;
                        flex-direction: column;
                        overflow: hidden;
                    }

                    .fixed-chatbot-header {
                        background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
                        color: white;
                        padding: 15px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }

                    .fixed-chatbot-header h3 {
                        font-size: 1.2rem;
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        margin: 0;
                    }

                    .fixed-chatbot-actions {
                        display: flex;
                        gap: 10px;
                    }

                    .fixed-chatbot-actions button {
                        background: transparent;
                        border: none;
                        color: white;
                        cursor: pointer;
                        padding: 5px;
                        border-radius: 5px;
                        transition: background 0.2s;
                    }

                    .fixed-chatbot-actions button:hover {
                        background: rgba(255, 255, 255, 0.2);
                    }

                    .fixed-chatbot-messages {
                        flex: 1;
                        padding: 15px;
                        overflow-y: auto;
                        display: flex;
                        flex-direction: column;
                        gap: 15px;
                        background-color: #f8fafc;
                    }

                    .fixed-message {
                        max-width: 80%;
                        padding: 10px 15px;
                        border-radius: 18px;
                        line-height: 1.4;
                        animation: fadeIn 0.3s ease;
                    }

                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(10px); }
                        to { opacity: 1; transform: translateY(0); }
                    }

                    .fixed-message.user {
                        align-self: flex-end;
                        background-color: #4b6cb7;
                        color: white;
                        border-bottom-right-radius: 5px;
                    }

                    .fixed-message.bot {
                        align-self: flex-start;
                        background-color: #e5e7eb;
                        color: #333;
                        border-bottom-left-radius: 5px;
                    }

                    .fixed-chatbot-input {
                        padding: 15px;
                        border-top: 1px solid #e5e7eb;
                        display: flex;
                        gap: 10px;
                        background-color: white;
                    }

                    .fixed-chatbot-input-field {
                        flex: 1;
                        padding: 12px 15px;
                        border: 1px solid #e5e7eb;
                        border-radius: 25px;
                        outline: none;
                        transition: border 0.3s;
                    }

                    .fixed-chatbot-input-field:focus {
                        border-color: #4b6cb7;
                    }

                    .fixed-chatbot-send {
                        background-color: #4b6cb7;
                        color: white;
                        border: none;
                        border-radius: 50%;
                        width: 40px;
                        height: 40px;
                        cursor: pointer;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        transition: background 0.3s;
                    }

                    .fixed-chatbot-send:hover {
                        background-color: #3a559d;
                    }

                    .fixed-typing-indicator {
                        display: flex;
                        align-items: center;
                        gap: 5px;
                        color: #6b7280;
                        font-style: italic;
                    }

                    .fixed-typing-dot {
                        width: 6px;
                        height: 6px;
                        background-color: #6b7280;
                        border-radius: 50%;
                        animation: typingAnimation 1.4s infinite ease-in-out;
                    }

                    .fixed-typing-dot:nth-child(1) { animation-delay: 0s; }
                    .fixed-typing-dot:nth-child(2) { animation-delay: 0.2s; }
                    .fixed-typing-dot:nth-child(3) { animation-delay: 0.4s; }

                    @keyframes typingAnimation {
                        0%, 60%, 100% { transform: translateY(0); }
                        30% { transform: translateY(-5px); }
                    }

                    @media (max-width: 768px) {
                        .fixed-chatbot-container {
                            width: 320px;
                            right: 10px;
                            bottom: 10px;
                        }
                    }
                `;

                document.head.appendChild(styleElement);
            }
        }
    </script>

    <script src="./script/glp.js"></script>
</body>
</html>
